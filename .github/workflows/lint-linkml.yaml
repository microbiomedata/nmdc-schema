###############################################################################
# Purpose:
# --------
# Runs LinkML schema linting on pull requests that modify schema files.
# Fails the build if there are any linting errors.
#
# When it runs:
# -------------
# - Pull requests that modify src/schema/**/*.yaml or .linkmllint.yaml
# - Manual trigger (workflow_dispatch)
#
# What it does:
# -------------
# - Runs 'make linkml-lint' which validates schema quality
# - Fails the build on any linting errors (warnings are allowed)
#
# Status: Required check - must pass before merging
###############################################################################

---
name: LinkML Linting
on:
  pull_request:
    paths:
      - "src/schema/**/*.yaml"
      - ".linkmllint.yaml"
  workflow_dispatch:  # Allow manual triggering

jobs:
  linkml-lint:
    name: LinkML Schema Linting
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Poetry
        run: pipx install poetry

      - name: Set up Python 3.10
        uses: actions/setup-python@v6
        with:
          python-version: '3.10'
          cache: 'poetry'

      - name: Install dependencies
        run: poetry install

      - name: Run LinkML linting
        run: make linkml-lint
